# 运输层

* [UDP](#UDP)
    * [特性](#特性)
    * [校验和](#校验和)
* [TCP](#TCP)
    * [三次握手](#三次握手)
    * [四次挥手](#四次挥手)
    * [可靠数据传输](#可靠数据传输)
    * [流量控制](#流量控制)
    * [拥塞控制](#拥塞控制)


## UDP
### 特性
* 1. __无连接__ : UDP不需要握手，不需要在客户端和服务器维护连接和交互状态。
* 2. UDP 不保证数据不丢失，不保证按序到达。
* 3. UDP基于 __数据报__ 发送。

### 校验和
* UDP 提供了差错检测功能。通过 __校验和(checksum)__ 可以确定UDP报文段从源到达目的地时，比特是否发生了改变。
* 虽然UDP提供了差错检测，但对差错恢复无能为力。


## TCP
* TCP 是 __面向连接__ 的，在两个进程发送数据之前，必须先建立连接(__握手__)，连接双方都会保持各自的状态。

### 报文段结构
* __源端口号__ 和 __目的端口号__ 用于确定数据交付，发送个哪个应用。
* __校验和__ 提供了差错检测。
* __序号和确认序号__ 用来实现可靠数据传输服务。
* __标志字段__ 用于控制TCP的状态位。
* __接收窗口__ 用于流量控制。

### 三次握手
* 1. 客户端首先向服务器发送一个SYN=1的 __SYN报文段__。客户段还会随机选择一个初始序号 SYN=1，seq=client_isn。
* 2. 服务端收到SYN报文段后，会为TCP连接分配缓冲区和变量，TCP连接处于半开状态。同时服务端向客户端发送 __SYNACK报文段__。 SYN=1，ACK=1，ack=client_isn+1(确认号字段)，seq=server_isn(初始序号)。
* 3. 客户端收到 __SYNACK报文段__ 后，会给该TCP连接分配缓存和变量，同时向服务器发送一个允许连接报文段的确认。 SYN=0,ACK=1，ack=server_isn+1，seq=client_isn+1。可以在确认报文负载中携带数据信息。
* __为什么需要三次握手__ ：
    * 1. 避免历史连接初始化。因为网络阻塞的原因，在连接建立阶段，一个旧的 __SYN报文段__ 比一个新的 __SYN报文段__ 先到达服务端，服务端放回 __SYNACK报文段__。客户端可以根据ack序号来判断这是一个历史连接，在第三次握手时，发送一个 __RST__ 报文，表示终止这一次连接，同时避免了资源浪费。
    * 2. 同步双方的初始序列号。 协议中的初始序号，使得接收方可以去除重复数据，并保证按序接收。还可以标识发送出去的数据包，哪些是对端已经接收成功的。使用三次握手，保证了双方的序列号可靠的同步。如果使用二次握手，就不能保证客户端成功同步了服务端的序列号。
    
* 为什么客户端和服务端的初始序列号 __isn__ 是不相同的： 
    * 如果一个已经失效的连接被重用，但是该旧连接的历史报文还残留在网络中，如果序列号相同，那么就无法分辨出该报文是不是历史报文，如果历史报文被新的连接接收了，则会产生数据错乱。所以，每次建立连接前都要初始化一个序列号主要是为了通信双方能够根据序号将不属于本连接的报文段丢弃。

### 四次挥手

### 可靠数据传输

### 流量控制

### 拥塞控制



